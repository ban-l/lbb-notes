# JVM命令

## 常见命令

### jmap - 堆内存分析

JVM Memory Map，命令用于生成heap dump文件。

还可以使用-XX:+HeapDumpOnOutOfMemoryError参数，虚拟机OOM时，自动生成dump文件。

```bash
# 查看堆内存概要
jmap -heap <pid>

# 查看对象直方图
jmap -histo:live <pid> | head -20

# 生成堆转储文件
jmap -dump:format=b,file=heap.bin <pid>

# 只转储存活对象
jmap -dump:live,format=b,file=heap.bin <pid>
```

### jhat

JVM Heap Analysis Tool，jhat与jmap搭配使用，用来分析jmap生成的dump。

### jstat - GC统计监控

JVM statistics Monitoring 用于监视虚拟机运行时状态信息的命令。

- 可以显示出虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。

```bash
# 监控GC统计信息
jstat -gcutil <pid> 1s

# 输出字段说明:
# S0  - Survivor0使用率
# S1  - Survivor1使用率  
# E   - Eden使用率
# O   - 老年代使用率
# M   - 元空间使用率
# CCS - 压缩类空间使用率
# YGC - Young GC次数
# YGCT- Young GC总时间
# FGC - Full GC次数
# FGCT- Full GC总时间
# GCT - GC总时间
```

### jstack - 线程分析

生成java虚拟机当前时刻的线程快照（查看线程在做什么）

- jstack查看各个线程的调用堆栈，可以知道没有响应的线程到底在后台做什么事情，或者等待什么资源。
- 如果java程序崩溃生成core文件，jstack工具可以用来获得core文件的java stack和native stack的信息，从而可以知道java程序是如何崩溃和在程序何处发生问题。

```bash
# 查看线程堆栈
jstack <pid>

# 查找死锁
jstack -l <pid>
```

### jps

JVM Process Status Tool，显示指定系统内所有的HotSpot虚拟机进程。