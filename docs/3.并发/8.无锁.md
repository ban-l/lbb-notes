# ⽆锁

- 根据最后3位标识位来判断，⽆锁是`001`，偏向标志为0，锁标志为01。
- `001`状态是⽆锁不可偏，⽆锁不可偏状态下遇到同步，会直接升级为轻量级锁，⽽不会变为偏向锁。
- `101`状态是⽆锁可偏，只有在⽆锁可偏的状态下，才可能变成偏向锁。
- ⽆锁可偏（匿名偏向）状态下虽然标识码是`101`，但是线程ID部分全为0，意味着没有线程实际获得偏向锁。

## ⽆锁可偏和⽆锁不可偏区分？

- 因为所有偏向锁的起点就是⽆锁可偏，只有在⽆锁可偏的状态下，才可能变成偏向锁。
- ⽆锁不可偏状态会直接变为轻量级锁。

## JVM为什么延迟启⽤偏向锁？

JDK8默认启动了偏向锁，偏向锁在JVM启动4秒(默认4秒)后启动，此时能设置为匿名偏向的会全部设置为匿名偏向，匿名偏向是偏向锁的起点。

JVM库类会使⽤`synchronized`，存在多线程竞争情况，如果开始就采⽤锁升级策略，撤销偏向锁会浪费很多时间。

- 若刚开始就设置为⽆锁可偏，存在线程竞争，偏向锁会撤销，然后升级，浪费资源。

- 所以JVM索性先不开启偏向锁，先执⾏这些库类，等过⼏秒再开启偏向锁。
- ⾄于JDK8为啥默认4秒，这是个经验值，4秒⼤多数类都启动完了，此数值可以修改。

## 对象创建是无锁还是偏向锁？

当一个对象创建的时候要看该对象创建的时候**是否已经启动了偏向锁**。

- 如果没有启动，则对象锁状态为无锁状态。
- 如果**启用**了偏向锁，则对象锁状态为偏向锁状态。

